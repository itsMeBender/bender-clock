<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>bender-dual-clock test</title>

    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../web-component-tester/browser.js"></script>

    <link rel="import" href="../bender-clock.html">
  </head>
  <body>
    <test-fixture id="basic">
      <template>
        <bender-clock id="myClock0"></bender-clock>
        <bender-clock id="myClock1" time="1:23:45"></bender-clock>
      </template>
    </test-fixture>

    <script>
      suite('bender-clock', function() {
        /* global
          setup, expect
        */
        var element;
        var hour0;
        var hour1;
        var hourRotation0;
        var hourRotation1;
        var minute0;
        var minute1;
        var minuteRotation0;
        var minuteRotation1;
        var second0;
        var second1;
        var secondRotation0;
        var secondRotation1;

        setup(function() {
          element = fixture('basic');

          // Frame rotation is the starting rotation of given time.
          // These elements are under control of the JavaScript to handle the initial start time rotation.
          hour0 = element[0].$$('.hour--frame');
          minute0 = element[0].$$('.minute--frame');
          second0 = element[0].$$('.second--frame');

          hour1 = element[1].$$('.hour--frame');
          minute1 = element[1].$$('.minute--frame');
          second1 = element[1].$$('.second--frame');

          // This is the full 360deg, hour, minute and second (hand) rotation.
          // Animated by CSS 'animation: rotate 43200s infinite linear'.
          hourRotation0 = element[0].$$('.hour--full-rotation');
          minuteRotation0 = element[0].$$('.minute--full-rotation');
          secondRotation0 = element[0].$$('.second--full-rotation');

          hourRotation1 = element[1].$$('.hour--full-rotation');
          minuteRotation1 = element[1].$$('.minute--full-rotation');
          secondRotation1 = element[1].$$('.second--full-rotation');
        });

        // Elements
        test('H01 - Instantiating the element works', function() {
          expect(element[0].is).to.be.equal('bender-clock');
          expect(element[0].id).to.be.equal('myClock0');
          expect(element[1].is).to.be.equal('bender-clock');
          expect(element[1].id).to.be.equal('myClock1');

          // Rotation container frames
          expect(hour0.nodeName).to.be.equal('DIV');
          expect(minute0.nodeName).to.be.equal('DIV');
          expect(second0.nodeName).to.be.equal('DIV');

          expect(hour1.nodeName).to.be.equal('DIV');
          expect(minute1.nodeName).to.be.equal('DIV');
          expect(second1.nodeName).to.be.equal('DIV');

          // Hour, minute and second clock pointer, identified by className
          expect(hourRotation0.firstElementChild.classList[0]).to.be.equal('hour');
          expect(minuteRotation0.firstElementChild.classList[0]).to.be.equal('minute');
          expect(secondRotation0.firstElementChild.classList[0]).to.be.equal('second');

          expect(hourRotation1.firstElementChild.classList[0]).to.be.equal('hour');
          expect(minuteRotation1.firstElementChild.classList[0]).to.be.equal('minute');
          expect(secondRotation1.firstElementChild.classList[0]).to.be.equal('second');
        });

        // ///////////////////////////////////////////////////////////////////////
        // Check TIME attribute
        // ///////////////////////////////////////////////////////////////////////

        // Clock0 has current time.
        test('K01 - Check clock 0 with curent time', function() {
          var clock = new Date();
          var h;
          var hour;
          var m;
          var minute;
          var s;
          var second;

          h = clock.getHours();
          h = h > 12 ? h - 12 : h; // Convert to 12 hour clock.
          h = h * 60 * 60; // Seconden

          m = clock.getMinutes();
          m = m * 60; // Seconden

          s = clock.getSeconds();

          h = Math.round((h + m + s) / (60 * 60 * 12) * 360); // Deg.
          expect(hour0.style.transform).to.be.equal('rotateZ(' + h + 'deg)');
          m = Math.round((m + s) / (60 * 60) * 360); // Deg.
          expect(minute0.style.transform).to.be.equal('rotateZ(' + m + 'deg)');
          s = Math.round(s / 60 * 360); // Deg.
          expect(second0.style.transform).to.be.equal('rotateZ(' + s + 'deg)');
        });

        // Clock1 has time set by `time` attribute.
        test('K02 - Check clock 1 with `time` attribute', function() {
          expect(hour1.style.transform).to.be.equal('rotateZ(42deg)');
          expect(minute1.style.transform).to.be.equal('rotateZ(143deg)');
          expect(second1.style.transform).to.be.equal('rotateZ(270deg)');
        });
      });
    </script>
  </body>
</html>
